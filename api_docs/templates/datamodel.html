{% extends "base/inside_page.html" %}
{% load markdown_content %}
{% block breadcrumb %}
<div class="right-content__breadcrumb">
  <div class="col-xs-11 no-pad-r">
    <ol class="breadcrumb">
      <li><a href="/api/analysis/">Analysis</a></li>
    </ol>
  </div>
</div>
{% endblock %}

{% block right_content %}
<h1>URLs Datamodel</h1>
<div id="datamodel">
  <form class="form-inline">
    <div class="form-group">
      <label>Comparison Group:</label>
      <select name="selectFieldGroup" class="form-control input-sm">
        <option value="current" selected>Current</option>
        <option value="previous">Previous</option>
        <option value="diff">Diff</option>
      </select>
    </div>
  </form>
  <table class="table datamodel-table">
    <thead>
      <tr>
        <th>Field Id</th>
        <th>Name</th>
        <th>Permissions</th>
        <th>Type</th>
        <th>SubType</th>
        <th>Multiple</th>
        <th>Group</th>
      </tr>
    </thead>
  </table>
</div>
{% md_content "partials/urls-datamodel.md" %}
{% endblock %}

{% block extra_script %}
<script type="text/javascript">
  $.fn.dataTable.ext.search.push(
    function( settings, data, dataIndex ) {
        var comparisonGroup = $('select[name=selectFieldGroup]').val();
        var group = data[6];
        if (comparisonGroup === 'current') {
          if (group.indexOf('previous.') !== 0 && group.indexOf('diff.') !== 0){
            return true;
          }
        } else {
          if (group.indexOf(comparisonGroup + '.') === 0) {
            return true;
          }
        }
        return false;
    }
  );

  $(function () {
    var initialFilter = url('?') && url('?').filter;

    var datamodel = $('#datamodel table').DataTable({
      processing: true,
      ajax: {
        url: "{{ datamodel_api_url }}",
        dataType: "json",
        dataSrc: "fields",
      },
      columns: [
        { data: "id" },
        { data: "name" },
        {
          data: "permissions",
          render: "[, ]"
        },
        { data: "type" },
        { data: "subtype" },
        { data: "multiple" },
        { data: "group" },
      ],
      scrollX: true,
      search: {
        regex: true,
        search: initialFilter || undefined,
      },
      pagingType: "numbers",
    });

    $('select[name=selectFieldGroup]').change( function() {
        datamodel.draw();
    } );
  });
</script>

<script>hljs.initHighlightingOnLoad();</script>
<script>
  $(document).ready(function() {
    $(".dropdown-toggle").dropdown();
  });
</script>
{% endblock %}
